<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snowy - CI360 Monitor</title>

    <!-- jQuery 3.7.1 (required for DataTables) -->
    <script src="lib/jquery-3.7.1.min.js"></script>

    <!-- jsrsasign for JWT token generation -->
    <script src="lib/jsrsasign-all-min.js"></script>

    <!-- DataTables 2.3.4 -->
    <link rel="stylesheet" href="css/datatables.min.css" />
    <script src="lib/datatables.min.js"></script>

    <!-- DataTables Buttons Extension for Export -->
    <link rel="stylesheet" href="css/buttons.dataTables.min.css" />
    <script src="lib/jszip.min.js"></script>
    <script src="lib/buttons.dataTables.min.js"></script>
    <script src="lib/buttons.html5.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />

    <!-- Bootstrap Icons -->
    <link href="css/bootstrap-icons.css" rel="stylesheet" />

    <!-- Custom Styles -->
    <link href="snowy-styles.css" rel="stylesheet" />
  </head>

  <body data-bs-theme="light">
    <!-- Header Section -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom p-0">
      <div class="container-fluid p-0">
        <!-- Row 1: Tab Navigation + Agent + Version -->
        <div class="header-row header-tabs">
          <ul class="nav nav-pills mb-0">
            <li class="nav-item">
              <button class="nav-link active recording-active" data-bs-toggle="pill" data-bs-target="#network-content" data-tab="network">
                <i class="bi bi-globe"></i>
                <span>SAS Tag - Web Traffic</span>
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="pill" data-bs-target="#events-content" data-tab="events">
                <i class="bi bi-broadcast"></i>
                <span>Agent: Event Stream</span>
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="pill" data-bs-target="#settings-content" data-tab="settings">
                <i class="bi bi-gear"></i>
                <span>Settings</span>
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="pill" data-bs-target="#info-content" data-tab="info">
                <i class="bi bi-info-circle"></i>
                <span>Info</span>
              </button>
            </li>
          </ul>

          <!-- Right side: Agent + Version -->
          <div class="header-right-items">
            <div class="info-item-compact" id="agent-info" title="Active agent">
              <i class="bi bi-cpu info-icon"></i>
              <span class="info-label-compact">Agent:</span>
              <span class="status-indicator status-active" id="agent-status"></span>
              <span class="text-active" id="agent-text">General Agent</span>
            </div>
            <div class="info-separator"></div>
            <div class="info-item-compact" id="version-display" title="Snowy version">
              <i class="bi bi-check-circle version-icon"></i>
              <span class="version-current"></span>
            </div>
          </div>
        </div>

        <!-- Row 2: Identity & Tenant Info -->
        <div class="header-row header-identity" id="identity-info">
          <div class="identity-panel-full">
            <div class="identity-item identity-clickable" id="identity-id-section" title="Click to view identity profile history" data-bs-toggle="offcanvas" data-bs-target="#identityOffcanvas" role="button">
              <i class="bi bi-person-badge info-icon"></i>
              <span class="info-label-compact">Identity ID:</span>
              <span class="status-indicator status-disconnected" id="identity-status"></span>
              <span class="text-disconnected identity-uuid-full" id="identity-text">Not detected</span>
            </div>
            <div class="info-separator" id="identity-tenant-separator"></div>
            <div class="identity-item" id="tenant-id-section">
              <i class="bi bi-building info-icon"></i>
              <span class="info-label-compact">Tenant ID:</span>
              <span class="status-indicator status-disconnected" id="tenant-status"></span>
              <span class="text-disconnected" id="tenant-text">Not Connected</span>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
      <div class="tab-content">
        <!-- Network Monitor Tab -->
        <div class="tab-pane fade show active" id="network-content">
          <div class="row g-0">
            <div class="col-12">
              <div class="network-table-container">
                <table id="networkTable" class="table table-sm table-hover compact-table display">
                  <thead class="table-dark">
                    <tr>
                      <th></th>
                      <th>Event</th>
                      <th>Event JSON</th>
                      <th>Quick Info</th>
                      <th>Time</th>
                      <th>Status</th>
                      <th>Datahub ID</th>
                      <th>Req#</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Event Stream Tab -->
        <div class="tab-pane fade" id="events-content">
          <div class="event-stream-table-container">
            <!-- Toolbar will be inserted by DataTables -->
            <table id="eventStreamTable" class="display" style="width: 100%">
              <thead>
                <tr>
                  <th></th>
                  <th>Event Name</th>
                  <th>Quick Info</th>
                  <th>Identity ID</th>
                  <th>Event JSON</th>
                  <th>Timestamp</th>
                  <th>Session ID</th>
                  <th>Channel User ID</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-pane fade" id="settings-content">
          <div class="settings-container">
            <!-- Settings Header -->
            <div class="settings-header">
              <i class="bi bi-gear-fill"></i>
              <span>Settings</span>
            </div>

            <!-- Event Stream Configuration (Priority Section) -->
            <div class="event-stream-config-section">
              <div class="config-section-header">
                <i class="bi bi-broadcast"></i>
                <span>Agent: Event Stream Configuration</span>
              </div>

              <div class="config-grid">
                <!-- Saved Tenants Card -->
                <div class="config-card">
                  <h6 class="config-card-title"><i class="bi bi-list-check"></i> Saved Tenants</h6>
                  <select id="saved-tenant-list" class="form-select form-select-sm mb-2">
                    <option value="">-- No saved tenants --</option>
                  </select>
                  <div class="d-grid gap-2">
                    <button class="btn btn-sm btn-primary" id="activate-tenant-btn" disabled><i class="bi bi-check-circle"></i> Activate</button>
                    <button class="btn btn-sm btn-outline-danger" id="forget-tenant-btn" disabled><i class="bi bi-trash"></i> Forget</button>
                  </div>
                </div>

                <!-- Add New Tenant Card -->
                <div class="config-card">
                  <h6 class="config-card-title"><i class="bi bi-plus-circle"></i> Add New Tenant</h6>

                  <select id="gateway-dropdown" class="form-select form-select-sm mb-2">
                    <option value="extapigwservice-demo.cidemo.sas.com">DEMO</option>
                    <option value="extapigwservice-eu-prod.ci360.sas.com">EU</option>
                    <option value="extapigwservice-prod.ci360.sas.com">US</option>
                    <option value="extapigwservice-syd-prod.ci360.sas.com">SYD</option>
                    <option value="extapigwservice-apn-prod.ci360.sas.com">APN</option>
                    <option value="extapigwservice-mum-prod.ci360.sas.com">MUM</option>
                    <option value="extapigwservice-training.ci360.sas.com">Training</option>
                    <option value="">Custom...</option>
                  </select>

                  <input type="text" id="gateway-custom" class="form-control form-control-sm mb-2" placeholder="Custom gateway URL" disabled />
                  <input type="text" id="tenant-id-input" class="form-control form-control-sm mb-2" placeholder="Tenant ID *" />
                  <input type="password" id="tenant-secret-input" class="form-control form-control-sm mb-2" placeholder="Client Secret *" />
                  <input type="text" id="tenant-name-input" class="form-control form-control-sm mb-2" placeholder="Friendly Name *" />

                  <div class="d-grid gap-1">
                    <button class="btn btn-sm btn-success" id="save-activate-btn"><i class="bi bi-save"></i> Save & Activate</button>
                    <div class="btn-group btn-group-sm">
                      <button class="btn btn-outline-primary" id="activate-only-btn"><i class="bi bi-play-circle"></i> Activate Only</button>
                      <button class="btn btn-outline-secondary" id="clear-config-btn"><i class="bi bi-x-circle"></i> Clear</button>
                    </div>
                  </div>
                </div>

                <!-- Active Configuration Card -->
                <div class="config-card active-config" id="active-config-display" style="display: none">
                  <h6 class="config-card-title text-success"><i class="bi bi-check-circle-fill"></i> Active Tenant</h6>
                  <div class="active-config-compact">
                    <div class="config-row">
                      <strong>Name:</strong>
                      <span id="active-tenant-name">--</span>
                    </div>
                    <div class="config-row">
                      <strong>ID:</strong>
                      <code id="active-tenant-id">--</code>
                    </div>
                    <div class="config-row">
                      <strong>Gateway:</strong>
                      <code id="active-gateway-url">--</code>
                    </div>
                  </div>
                </div>
              </div>

              <div class="alert alert-warning alert-sm mb-0 mt-2">
                <i class="bi bi-info-circle"></i>
                <small>Stored locally without encryption. It is preferred to use Diagnostics Access Point credentials, especially for production tenant.</small>
              </div>
            </div>

            <!-- Settings Grid -->
            <div class="settings-grid">
              <!-- Appearance Card -->
              <div class="setting-card">
                <div class="setting-card-header">
                  <i class="bi bi-palette-fill"></i>
                  <span>Appearance</span>
                </div>
                <div class="setting-item">
                  <div class="setting-label">
                    <i class="bi bi-moon-fill"></i>
                    <span>Dark Mode</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="theme-toggle-switch" />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>

              <!-- Status Colors Card -->
              <div class="setting-card">
                <div class="setting-card-header">
                  <i class="bi bi-droplet-fill"></i>
                  <span>Status Colors</span>
                </div>
                <div class="color-scheme-grid">
                  <label class="color-scheme-option">
                    <input type="radio" name="colorPreference" value="default" id="color-default" />
                    <div class="color-scheme-card">
                      <div class="color-preview">
                        <span class="color-dot" style="background: #28a745"></span>
                        <span class="color-dot" style="background: #ffc107"></span>
                        <span class="color-dot" style="background: #dc3545"></span>
                      </div>
                      <span class="color-scheme-name">Default</span>
                    </div>
                  </label>
                  <label class="color-scheme-option">
                    <input type="radio" name="colorPreference" value="high-contrast" id="color-high-contrast" />
                    <div class="color-scheme-card">
                      <div class="color-preview">
                        <span class="color-dot" style="background: #00cc00"></span>
                        <span class="color-dot" style="background: #ffcc00"></span>
                        <span class="color-dot" style="background: #ff0000"></span>
                      </div>
                      <span class="color-scheme-name">High Contrast</span>
                    </div>
                  </label>
                  <label class="color-scheme-option">
                    <input type="radio" name="colorPreference" value="colorblind-friendly" id="color-colorblind-friendly" />
                    <div class="color-scheme-card">
                      <div class="color-preview">
                        <span class="color-dot" style="background: #0173b2"></span>
                        <span class="color-dot" style="background: #de8f05"></span>
                        <span class="color-dot" style="background: #cc78bc"></span>
                      </div>
                      <span class="color-scheme-name">Colorblind</span>
                    </div>
                  </label>
                  <label class="color-scheme-option">
                    <input type="radio" name="colorPreference" value="soft" id="color-soft" />
                    <div class="color-scheme-card">
                      <div class="color-preview">
                        <span class="color-dot" style="background: #88d498"></span>
                        <span class="color-dot" style="background: #ffd966"></span>
                        <span class="color-dot" style="background: #ff9999"></span>
                      </div>
                      <span class="color-scheme-name">Soft</span>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Display Options Card -->
              <div class="setting-card">
                <div class="setting-card-header">
                  <i class="bi bi-eye-fill"></i>
                  <span>Top Bar Visibility</span>
                </div>
                <div class="setting-item">
                  <div class="setting-label">
                    <i class="bi bi-person-badge"></i>
                    <span>Identity ID</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="show-identity-id" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="setting-item">
                  <div class="setting-label">
                    <i class="bi bi-building"></i>
                    <span>Tenant ID</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="show-tenant-id" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="setting-item">
                  <div class="setting-label">
                    <i class="bi bi-cpu"></i>
                    <span>Active Agent</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="show-active-agent" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Info Tab -->
        <div class="tab-pane fade" id="info-content">
          <div class="info-guide-container">
            <!-- Header with Logo -->
            <div class="info-guide-header">
              <div class="info-header-left">
                <img src="images/snowy.png" alt="Snowy" class="info-logo" />
                <span>Snowy</span>
              </div>
              <div class="info-header-right">
                <a href="https://github.com/sassoftware/ci360-extensions" target="_blank" class="info-link"> <i class="bi bi-github"></i> GitHub </a>
                <button class="btn btn-sm btn-outline-primary" id="check-updates-btn"><i class="bi bi-arrow-repeat"></i> Check for Updates</button>
              </div>
            </div>

            <!-- Settings Tab -->
            <div class="info-section">
              <h6 class="info-section-title"><i class="bi bi-gear"></i> Settings</h6>
              <ul class="info-list">
                <li><strong>Agent Configuration:</strong> Configure gateway, tenant ID, and client secret. Save for reuse or activate temporarily</li>
                <li><strong>Theme & Display:</strong> Toggle light/dark mode and header visibility options</li>
              </ul>
            </div>

            <!-- Network Tab -->
            <div class="info-section">
              <h6 class="info-section-title"><i class="bi bi-globe"></i> SAS Tag - Web Traffic</h6>
              <ul class="info-list">
                <li>Auto-captures SAS CI360 tag events. Use Search to filter, click rows for full JSON</li>
                <li>Displays Identity information and history based on the captured events. Click on the Identity ID from the header row to display more details.</li>
                <li>Profile page enables you to fire identity event.</li>
              </ul>
            </div>

            <!-- Event Stream Tab -->
            <div class="info-section">
              <h6 class="info-section-title"><i class="bi bi-broadcast"></i> Agent: Event Stream</h6>
              <ul class="info-list">
                <li>Connect to Event Stream via CI 360 Agent framework. Configure credentials in Settings first</li>
                <li>Use Start/Stop to control connection, apply the identity filter when using Diagnostics Access Point</li>
                <li>If the Access Point is associated with Connector, then payload and JSON paths calculated to make it easy for configuring variable paths in CI 360 Connector Endpoint configuration</li>
              </ul>
            </div>

            <!-- Security Warnings -->
            <div class="info-section">
              <h6 class="info-section-title"><i class="bi bi-shield-exclamation text-danger"></i> Security Notice</h6>
              <div class="alert alert-danger info-alert">
                <ul class="info-warning-list">
                  <li><strong>Critical:</strong> Never use credentials from production Access Points or those integrated with external systems.</li>
                  <li><strong>Best Practice:</strong> Use Diagnostics Access Point credentials exclusively for monitoring purposes</li>
                  <li><strong>Data Storage:</strong> All credentials are stored locally in browser storage without encryption</li>
                  <li>
                    <strong>Responsibility:</strong>
                    <ul>
                      <li>Users are solely responsible for credential security and access control.</li>
                      <li>Do not use Identity values from actual customers (from production environments) in this tool for triggering identity information.</li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>

            <!-- Disclaimer -->
            <div class="info-section">
              <h6 class="info-section-title"><i class="bi bi-info-circle-fill"></i> Disclaimer</h6>
              <div class="alert alert-info info-alert">
                <ul class="info-disclaimer-list">
                  <li><strong>Purpose:</strong> Snowy is a developer tool designed to assist technical consultants and developers in troubleshooting SAS CI 360 implementations</li>
                  <li><strong>Data Accuracy:</strong> Displayed data is captured in real-time from browser context and may not reflect the exact data processed by SAS CI 360 servers</li>
                  <li><strong>Official Validation:</strong> For authoritative data verification, use official SAS CI 360 APIs, reports, or SAS CI360 Agent streaming capabilities</li>
                  <li><strong>Support:</strong> This is a community project, not an official SAS product, and is not covered by SAS support agreements</li>
                  <li><strong>Use at Own Risk:</strong> This tool is provided "as-is" without warranties of any kind</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Snowy Console -->
    <div class="snowy-console collapsed" id="snowy-console">
      <div class="console-header" id="console-header">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-terminal icon-md"></i>
          <span>Snowy Console</span>
          <span class="badge bg-secondary" id="console-count">0</span>
        </div>
        <div class="d-flex align-items-center gap-2">
          <!-- Log Level Filters -->
          <div class="btn-group btn-group-sm console-filters" role="group">
            <button type="button" class="btn btn-outline-secondary active" data-filter="info" title="Show Info logs">
              <i class="bi bi-info-circle"></i>
            </button>
            <button type="button" class="btn btn-outline-secondary active" data-filter="success" title="Show Success logs">
              <i class="bi bi-check-circle"></i>
            </button>
            <button type="button" class="btn btn-outline-secondary active" data-filter="warning" title="Show Warning logs">
              <i class="bi bi-exclamation-triangle"></i>
            </button>
            <button type="button" class="btn btn-outline-secondary active" data-filter="error" title="Show Error logs">
              <i class="bi bi-x-circle"></i>
            </button>
          </div>
          <button class="btn btn-sm btn-outline-secondary py-0 px-1" id="console-clear" title="Clear console">
            <i class="bi bi-trash icon-xs"></i>
          </button>
          <i class="bi bi-chevron-up console-toggle-icon"></i>
        </div>
      </div>
      <div class="console-content" id="console-content">
        <div class="console-log info">
          <span class="timestamp">[00:00:00]</span>
          <span>Snowy Console initialized...</span>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmModalLabel">Snowy says...</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="confirmModalBody">
            <!-- Message will be inserted here -->
          </div>
          <div class="modal-footer" id="confirmModalFooter">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
            <button type="button" class="btn btn-primary" id="confirmModalYes">Yes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Diagnostics Filter Modal -->
    <div class="modal fade" id="diagFilterModal" tabindex="-1" aria-labelledby="diagFilterModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="diagFilterModalLabel">Diagnostics Agent Filter</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="mb-3">Please select a filter condition for your diagnostics agent.</p>

            <div class="mb-3">
              <strong>Auto-detect from Network Traffic:</strong>
              <div class="form-check mt-2">
                <input class="form-check-input" type="radio" name="diagFilterType" id="diagFilterDatahubId" value="datahub_id" />
                <label class="form-check-label" for="diagFilterDatahubId"> Datahub ID: <span id="diagFilterDatahubIdValue" class="text-muted"></span> </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="diagFilterType" id="diagFilterSession" value="session_id" />
                <label class="form-check-label" for="diagFilterSession"> Session ID: <span id="diagFilterSessionValue" class="text-muted"></span> </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="diagFilterType" id="diagFilterChannelId" value="channel_id" />
                <label class="form-check-label" for="diagFilterChannelId"> Channel User ID: <span id="diagFilterChannelIdValue" class="text-muted"></span> </label>
              </div>
            </div>

            <div class="text-center my-2">
              <strong>- OR -</strong>
            </div>

            <div class="mb-3">
              <strong>Fixed Value:</strong>
              <div class="form-check mt-2">
                <input class="form-check-input" type="radio" name="diagFilterType" id="diagFilterCustom" value="custom" />
                <label class="form-check-label" for="diagFilterCustom"> Custom Filter </label>
              </div>
              <div class="input-group mt-2" id="diagFilterCustomInputs" style="display: none">
                <select class="form-select" id="diagFilterCustomType">
                  <option value="datahub_id">Datahub ID</option>
                  <option value="session_id">Session ID</option>
                  <option value="channel_id">Channel User ID</option>
                </select>
                <input type="text" class="form-control" id="diagFilterCustomValue" placeholder="Enter value" />
              </div>
            </div>

            <div class="alert alert-warning small mb-0" role="alert"><i class="bi bi-info-circle"></i> Auto-detect options are disabled if no network traffic has been detected.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="diagFilterApply">Apply Filter</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Info/Alert Modal -->
    <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="alertModalLabel">Snowy says...</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="alertModalBody">
            <!-- Message will be inserted here -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Identity Profile Offcanvas Panel -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="identityOffcanvas" aria-labelledby="identityOffcanvasLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="identityOffcanvasLabel"><i class="bi bi-person-circle"></i> Identity Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <!-- Current Identity Summary -->
        <div class="identity-summary">
          <div class="summary-header"><i class="bi bi-person-badge"></i> Current Identity</div>
          <div class="summary-row">
            <span class="summary-label">Datahub ID:</span>
            <span class="summary-value text-break" id="current-datahub-id">-</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Identity (PII):</span>
            <span class="summary-value text-break" id="current-pii">-</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Last Event:</span>
            <span class="summary-value" id="current-event">-</span>
          </div>
        </div>

        <!-- Fire Identity Events -->
        <div class="identity-events-section">
          <div class="section-header"><i class="bi bi-lightning-charge"></i> Fire Identity Events</div>
          <div class="section-help-text">
            <small class="text-muted"> <i class="bi bi-info-circle"></i> Events will be fired using CI360 JavaScript APIs on the inspected page </small>
          </div>
          <div class="identity-events-form">
            <div class="row g-2 mb-2">
              <div class="col-12">
                <label class="form-label small mb-1">Identity Type</label>
                <select class="form-select form-select-sm" id="identityType">
                  <option value="">Select Identity Type</option>
                  <option value="login_id">Login ID</option>
                  <option value="customer_id">Customer ID</option>
                  <option value="subject_id">Subject ID</option>
                </select>
              </div>
            </div>
            <div class="row g-2 mb-2">
              <div class="col-12">
                <label class="form-label small mb-1">Identity Value</label>
                <input type="text" class="form-control form-control-sm" id="identityValue" placeholder="Enter the identity value" />
              </div>
            </div>
            <div class="row g-2 mb-3">
              <div class="col-12">
                <label class="form-label small mb-1">Obfuscate Fields</label>
                <select class="form-select form-select-sm" id="identityObfuscate">
                  <option value="no">No, don't obfuscate</option>
                  <option value="yes">Yes, obfuscate the identity</option>
                </select>
              </div>
            </div>
            <div class="identity-events-buttons">
              <button class="btn btn-sm btn-primary" id="attachIdentityBtn"><i class="bi bi-link-45deg"></i> Attach Identity</button>
              <button class="btn btn-sm btn-danger" id="detachIdentityBtn"><i class="bi bi-x-circle"></i> Detach Identity</button>
            </div>
          </div>
          <div class="alert alert-info mt-3 mb-0 small" role="alert">
            <i class="bi bi-info-circle-fill"></i>
            <strong>Note:</strong> Attach Identity links an identity to the current visitor. Detach Identity removes all identity associations.
          </div>
        </div>

        <!-- Identity History Table -->
        <div class="profile-section">
          <div class="profile-section-header d-flex justify-content-between align-items-center">
            <div>
              <i class="bi bi-clock-history"></i> Identity Change History
              <span class="badge bg-secondary ms-2" id="profile-count">0</span>
            </div>
            <button class="btn btn-sm btn-outline-secondary" id="clearProfileHistory" title="Clear identity history"><i class="bi bi-trash"></i> Clear</button>
          </div>
          <div class="profile-table-wrapper">
            <table class="profile-table" id="profileTable">
              <thead>
                <tr>
                  <th>Req#</th>
                  <th>Time</th>
                  <th>Datahub ID</th>
                  <th>PII</th>
                  <th>Event</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="5" class="text-center text-muted">No identity data available</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Info Note -->
        <div class="identity-note">
          <i class="bi bi-info-circle"></i>
          Identity information is based on <i>SAS Tag - Web Traffic</i> tab.
        </div>
      </div>
    </div>

    <!-- Bootstrap Bundle with Popper (required for modals) -->
    <script src="lib/bootstrap.bundle.min.js"></script>

    <!-- Pako library for GZIP decompression -->
    <script src="lib/pako.min.js"></script>

    <!-- External JavaScript - Modular Architecture -->
    <script src="js/config.js"></script>
    <script src="js/connector-utils.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/version-manager.js"></script>
    <script src="js/tab-manager.js"></script>
    <script src="js/display-manager.js"></script>
    <script src="js/info-manager.js"></script>
    <script src="js/console-manager.js"></script>
    <script src="js/profile-manager.js"></script>
    <script src="js/tenant-config-manager.js"></script>
    <script src="js/network-table-manager.js"></script>
    <script src="js/event-stream-table-manager.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
